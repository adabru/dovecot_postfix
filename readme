Run

```
git clone https://github.com/adabru/dovecot_postfix.git
cd dovecot_postfix
docker build -t mail .
# if apk install fails try: (see https://github.com/gliderlabs/docker-alpine/issues/386#issuecomment-567684492)
# docker build -t mail --network=host .

# get inside the container:
docker run --rm --name test -ti -p 465:465 -p 993:993 -e DOMAIN=yourdomain.com -e MYNETWORKS="127.0.0.0/8 172.17.0.0/16" mail /bin/sh
```

```
# test global connectivity in both directions
ping adabru.de
nc -v -l -p 465

# change your domain
sed -i "s/example\.com/$DOMAIN/" /etc/postfix/main.cf
# add local trusted networks
sed -i "s|127\.0\.0\.0/8|$MYNETWORKS|" /etc/postfix/main.cf

syslogd
postfix start
stunnel

# check logs
tail /var/log/messages

# start a new terminal
```

```
DOMAIN=yourdomain.com
RECIPIENT=info@someotherdomain.com

# check connection
nc $DOMAIN 465

# check smtps service
msmtp -v --host=$DOMAIN --port=465 --tls=on --tls-starttls=off --tls-certcheck=off -S

# send email to yourself
echo -e "Subject: Hello\n\nWorld!" | \
msmtp -v --host=$DOMAIN --port=465 --tls=on --tls-starttls=off  --tls-certcheck=off --auth=off \
  --from=info@$DOMAIN --add-missing-from-header=on --add-missing-date-header=on \
  -- info@$DOMAIN

# send email to another server (must be run from same host)
echo -e "Subject: Hello\n\nWorld!" | \
msmtp -v --host=localhost --port=465 --tls=on --tls-starttls=off  --tls-certcheck=off --auth=off \
  --from=info@$DOMAIN --add-missing-from-header=on --add-missing-date-header=on \
  -- $RECIPIENT
```
